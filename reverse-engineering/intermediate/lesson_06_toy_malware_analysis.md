# Lesson 6: Toy Malware Analysis â€“ Analyzing Malicious Code

## Overview

**Malware analysis** is the process of understanding what malicious code does. This lesson covers the basics of analyzing simple malware samples.

Understanding malware analysis helps you:
- Understand how malware works
- Identify malicious behavior
- Extract indicators of compromise (IoCs)
- Develop detection signatures

## What You'll Learn

By the end of this lesson, you will understand:

- **Malware analysis workflow**
- **Static analysis** of malware
- **Dynamic analysis** of malware
- **Identifying malicious behavior**
- **Extracting IoCs** (indicators of compromise)

## Prerequisites

Before starting this lesson, you should:

- Have completed Lessons 1-5 of this course
- Understand reverse engineering basics
- Be comfortable with x64dbg and Binary Ninja

## Malware Analysis Workflow

A typical malware analysis workflow includes:

1. **Triage**: Quick analysis to determine if it's malware
2. **Static Analysis**: Analyze the binary without running it
3. **Dynamic Analysis**: Run the malware in a sandbox and observe behavior
4. **IoC Extraction**: Extract indicators of compromise
5. **Report**: Document findings

## Static Analysis of Malware

Static analysis involves analyzing the binary without running it.

### Steps

1. **Check the file type**: Is it a PE executable?
2. **Check for packing**: Is it packed?
3. **Analyze imports**: What functions does it import?
4. **Analyze strings**: What strings are in the binary?
5. **Analyze code**: What does the code do?

### Red Flags

- Imports for process injection (CreateRemoteThread, VirtualAllocEx)
- Imports for registry modification (RegSetValueEx)
- Imports for file operations (CreateFileA, WriteFile)
- Suspicious strings (URLs, IP addresses, registry keys)

## Dynamic Analysis of Malware

Dynamic analysis involves running the malware in a sandbox and observing behavior.

### Steps

1. **Set up a sandbox**: Use a virtual machine isolated from the network
2. **Monitor system calls**: Use tools like ProcMon to monitor system calls
3. **Monitor network traffic**: Use tools like Wireshark to monitor network traffic
4. **Monitor file operations**: Watch for file creation, modification, deletion
5. **Monitor registry operations**: Watch for registry modifications

### Tools

- **ProcMon**: Monitor system calls
- **Wireshark**: Monitor network traffic
- **Process Explorer**: Monitor processes and threads
- **Autoruns**: Monitor startup locations

## Extracting IoCs

**Indicators of Compromise (IoCs)** are artifacts that indicate malware activity.

### Types of IoCs

- **File hashes**: MD5, SHA1, SHA256 of malware files
- **File paths**: Locations where malware creates files
- **Registry keys**: Registry keys modified by malware
- **Network indicators**: URLs, IP addresses, domain names
- **Process names**: Names of processes created by malware

## Exercises

### Exercise 1: Analyze a Simple Malware Sample

**Objective**: Learn to analyze malware.

**Steps**:
1. Download a simple malware sample (or create a toy malware)
2. Perform static analysis:
   - Check the file type
   - Check for packing
   - Analyze imports
   - Analyze strings
3. Document your findings

**Verification**: You should be able to identify malicious characteristics.

### Exercise 2: Dynamic Analysis of Malware

**Objective**: Learn to perform dynamic analysis.

**Steps**:
1. Set up a virtual machine sandbox
2. Run the malware sample
3. Monitor system calls using ProcMon
4. Monitor network traffic using Wireshark
5. Document the malware's behavior

**Verification**: You should be able to identify malicious behavior.

### Exercise 3: Extract IoCs

**Objective**: Learn to extract indicators of compromise.

**Steps**:
1. Analyze a malware sample
2. Extract:
   - File hashes
   - File paths
   - Registry keys
   - Network indicators
   - Process names
3. Document your findings

**Verification**: You should be able to extract IoCs.

## Solutions

### Solution 1: Analyze a Simple Malware Sample

When you analyze malware, you should look for:
- Suspicious imports (CreateRemoteThread, VirtualAllocEx)
- Suspicious strings (URLs, IP addresses)
- Packing or obfuscation

### Solution 2: Dynamic Analysis of Malware

When you run malware in a sandbox, you should observe:
- File creation/modification
- Registry modifications
- Network connections
- Process creation

### Solution 3: Extract IoCs

When you extract IoCs, you should document:
- File hashes
- File paths
- Registry keys
- Network indicators
- Process names

## Summary

You now understand malware analysis. You can:

- Perform static analysis of malware
- Perform dynamic analysis of malware
- Identify malicious behavior
- Extract indicators of compromise
- Document malware analysis findings

In the next lesson, you'll learn about automation with Python.
